<div class="container-fluid p-0">
    {{! Filter and sort controls }}
    <div class="mb-3 d-flex justify-content-between align-items-center">
        <div class="filter-controls">
            <div class="btn-group filter-buttons">
                <button class="btn btn-outline-secondary active" data-filter="all">{{#str}}filterall, local_eventocoursecreation{{/str}}</button>
                <button class="btn btn-outline-secondary" data-filter="ready">{{#str}}filterready, local_eventocoursecreation{{/str}}</button>
                <button class="btn btn-outline-secondary" data-filter="blocked">{{#str}}filterblocked, local_eventocoursecreation{{/str}}</button>
            </div>
        </div>
        <div class="sort-controls">
            <div class="input-group">
                <div class="input-group-prepend">
                    <span class="input-group-text">{{#str}}sortby, local_eventocoursecreation{{/str}}</span>
                </div>
                <select class="custom-select sort-select">
                    <option value="status">{{#str}}sortstatus, local_eventocoursecreation{{/str}}</option>
                    <option value="date">{{#str}}sortdate, local_eventocoursecreation{{/str}}</option>
                    <option value="name">{{#str}}sortname, local_eventocoursecreation{{/str}}</option>
                </select>
            </div>
        </div>
    </div>

    {{! Batch selection controls }}
    <div class="mb-3 d-flex flex-wrap batch-controls">
        <div class="form-check mr-3">
            <input type="checkbox" class="form-check-input" id="select-all-eligible">
            <label class="form-check-label" for="select-all-eligible">{{#str}}selectalleligible, local_eventocoursecreation{{/str}}</label>
        </div>
        <div class="form-check mr-3">
            <input type="checkbox" class="form-check-input" id="force-all">
            <label class="form-check-label" for="force-all">{{#str}}forceall, local_eventocoursecreation{{/str}}</label>
        </div>
        <div class="selection-count ml-auto">
            <span class="badge badge-info">
                <span id="selected-count">0</span> / <span id="total-count">{{courses.length}}</span> {{#str}}selected, local_eventocoursecreation{{/str}}
            </span>
        </div>
    </div>

    {{! Course grid }}
    <div class="row" data-region="course-grid">
        {{#courses}}
        <div class="col-12 col-md-6 col-lg-4 mb-3 course-item" 
             data-event-id="{{eventId}}"
             data-status="{{#canCreate}}ready{{/canCreate}}{{^canCreate}}blocked{{/canCreate}}"
             data-name="{{name}}"
             data-in-period="{{#isInCreationPeriod}}true{{/isInCreationPeriod}}{{^isInCreationPeriod}}false{{/isInCreationPeriod}}"
             data-is-sub-event="{{#isSubEvent}}true{{/isSubEvent}}{{^isSubEvent}}false{{/isSubEvent}}"
             data-parent-exists="{{#parentCourseExists}}true{{/parentCourseExists}}{{^parentCourseExists}}false{{/parentCourseExists}}"
             data-date="{{startdate}}"
             class="{{#isSubEvent}}sub-event{{/isSubEvent}} {{^isInCreationPeriod}}out-of-period{{/isInCreationPeriod}}">
            <div class="card h-100 course-preview-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div class="status-badge {{statusClass}}">{{statusText}}</div>
                    <div class="form-check">
                        <input type="checkbox" 
                               class="form-check-input force-create" 
                               id="force-{{eventId}}">
                        <label class="form-check-label" for="force-{{eventId}}">
                            {{#str}}force, local_eventocoursecreation{{/str}}
                        </label>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="mb-3 d-flex align-items-center">
                        <div class="form-check">
                            <input type="checkbox" 
                                   class="form-check-input course-select" 
                                   id="select-{{eventId}}"
                                   value="{{eventId}}"
                                   {{#canCreate}}checked{{/canCreate}}
                                   {{^canCreate}}disabled{{/canCreate}}>
                            <label class="form-check-label" for="select-{{eventId}}">
                                {{#str}}select, local_eventocoursecreation{{/str}}
                            </label>
                        </div>
                    </div>

                    <h5 class="card-title">{{name}}</h5>
                    <p class="card-text text-muted">{{categoryname}}</p>
                    <p class="card-text">
                        <small class="text-muted">{{formattedStartDate}} - {{formattedEndDate}}</small>
                    </p>

                    {{! New: Sub-event indicator }}
                    {{#isSubEvent}}
                    <div class="alert alert-info mt-2">
                        <small><i class="fa fa-link"></i> {{#str}}eventissubevent, local_eventocoursecreation{{/str}}</small>
                        
                        {{#parentCourseMissing}}
                        <div class="mt-1">
                            <small><i class="fa fa-exclamation-triangle text-warning"></i> {{#str}}parentcoursenotexists, local_eventocoursecreation{{/str}}</small>
                        </div>
                        {{/parentCourseMissing}}
                        
                        {{#parentCourseExists}}
                        <div class="mt-1">
                            <small><i class="fa fa-check-circle text-success"></i> {{#str}}parentcourseexists, local_eventocoursecreation{{/str}}</small>
                        </div>
                        {{/parentCourseExists}}
                    </div>
                    {{/isSubEvent}}
                    
                    {{! New: Creation period indicator }}
                    {{^isInCreationPeriod}}
                    <div class="alert alert-warning mt-2">
                        <small><i class="fa fa-clock-o"></i> {{#str}}notincreationperiod, local_eventocoursecreation{{/str}}</small>
                    </div>
                    {{/isInCreationPeriod}}

                    {{! Existing block reason }}
                    {{^canCreate}}
                    <div class="alert alert-warning mt-2">
                        <small><i class="fa fa-exclamation-triangle"></i> {{createBlockReason}}</small>
                    </div>
                    {{/canCreate}}

                    {{#subcourses.length}}
                    <div class="alert alert-info mt-3">
                        <h6 class="alert-heading">{{#str}}subcourses, local_eventocoursecreation{{/str}}</h6>
                        <ul class="list-unstyled mb-0">
                            {{#subcourses}}
                            <li>{{name}}</li>
                            {{/subcourses}}
                        </ul>
                    </div>
                    {{/subcourses.length}}

                    <button class="btn btn-primary w-100 mt-3 create-single"
                            {{^canCreate}}disabled{{/canCreate}}>
                        {{#str}}create, local_eventocoursecreation{{/str}}
                    </button>
                </div>
            </div>
        </div>
        {{/courses}}
    </div>

    {{#courses.length}}
    <div class="mt-3 text-right">
        <button class="btn btn-success create-selected" disabled>
            {{#str}}createselected, local_eventocoursecreation{{/str}}
            <span class="selected-count-badge badge badge-light">0</span>
        </button>
    </div>
    {{/courses.length}}
</div>

{{^courses.length}}
<div class="alert alert-info">
    <i class="fa fa-info-circle"></i> {{#str}}nocoursestocreate, local_eventocoursecreation{{/str}}
</div>
{{/courses.length}}